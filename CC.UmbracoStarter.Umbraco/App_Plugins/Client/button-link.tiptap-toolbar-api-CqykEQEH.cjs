"use strict";var b=i=>{throw TypeError(i)};var B=(i,o,t)=>o.has(i)||b("Cannot "+t);var g=(i,o,t)=>o.has(i)?b("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(i):o.set(i,t);var l=(i,o,t)=>(B(i,o,"access private method"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("@umbraco-cms/backoffice/external/tiptap"),L=require("@umbraco-cms/backoffice/modal"),_=require("@umbraco-cms/backoffice/tiptap"),w=require("./manifests-BcBivxRP.cjs"),y=new L.UmbModalToken(w.BUTTON_LINK_MODAL_ALIAS,{modal:{type:"sidebar",size:"medium"}});var e,k,A,T,x,M,U,O;class N extends _.UmbTiptapToolbarElementApiBase{constructor(){super(...arguments);g(this,e)}async execute(t){var m;const a=(t==null?void 0:t.getAttributes(d.UmbLink.name))??{};let n=l(this,e,k).call(this,a);const f={config:{},index:null,isNew:(n==null?void 0:n.url)===void 0},r={link:n},p=((m=this.configuration)==null?void 0:m.getValueByAlias("overlaySize"))??"small",s=(await this.getContext(L.UMB_MODAL_MANAGER_CONTEXT)).open(this,y,{data:f,value:r,modal:{size:p}});if(!s)return;const c=await s.onSubmit().catch(()=>{});if(!(c!=null&&c.link))return;n=c.link;const h=l(this,e,A).call(this,n);h?t==null||t.chain().focus().extendMarkRange(d.UmbLink.name).setButtonLink(h).run():t==null||t.chain().focus().extendMarkRange(d.UmbLink.name).unsetButtonLink().run()}}e=new WeakSet,k=function(t){var r;const a=t["data-anchor"],n=(r=t.href)==null?void 0:r.substring(0,t.href.length-((a==null?void 0:a.length)??0)),f=n!=null&&n.includes("localLink:")?n.substring(n.indexOf(":")+1,n.indexOf("}")):null;return{name:t.title,queryString:a,target:t.target,type:t.type,unique:f,url:n}},A=function(t){const{name:a,target:n,type:f,unique:r,backgroundColor:p}=t;let{queryString:u,url:s}=t;if(u=l(this,e,O).call(this,u),!u){const m=l(this,e,T).call(this,s,u);s=m.url,u=m.queryString}r?s=`/{localLink:${r}}`:(s=l(this,e,M).call(this,s),s=l(this,e,x).call(this,s));const c=l(this,e,U).call(this,u);if(c&&(s=(s??"")+c),!s)return null;const h={};return p&&(h["--color-background"]=p),{type:f??"external",href:s,class:"btn",style:h,"data-anchor":c,target:n,title:a??s}},T=function(t,a){const n=t==null?void 0:t.split(/([#?])/);return(n==null?void 0:n.length)===3&&(t=n[0],a=n[1]+n[2]),{url:t,queryString:a}},x=function(t){return t?(/^\s*www\./i.test(t)&&(t=`http://${t}`),t):null},M=function(t){return t?(t!=null&&t.includes("@")&&!t.includes("//")&&!t.includes(":")&&(t=`mailto:${t}`),t):null},U=function(t){return t&&(t.startsWith("#")||t.startsWith("?"))?t:null},O=function(t){return t?(!t.startsWith("?")&&!t.startsWith("#")&&(t=(t.startsWith("=")?"#":"?")+t),t):null};exports.default=N;
//# sourceMappingURL=button-link.tiptap-toolbar-api-CqykEQEH.cjs.map
