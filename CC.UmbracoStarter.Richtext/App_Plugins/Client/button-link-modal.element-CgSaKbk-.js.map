{"version":3,"file":"button-link-modal.element-CgSaKbk-.js","sources":["../../Client/src/button-link/button-link-modal/button-link-modal.element.ts"],"sourcesContent":["import type { ButtonLinkPickerLink } from \"./types.js\";\r\nimport type {\r\n  UmbLinkPickerConfig,\r\n  ButtonLinkPickerModalData,\r\n  ButtonLinkPickerModalValue,\r\n} from \"./button-link-modal.token.js\";\r\nimport {\r\n  css,\r\n  customElement,\r\n  html,\r\n  nothing,\r\n  query,\r\n  state,\r\n  when,\r\n} from \"@umbraco-cms/backoffice/external/lit\";\r\nimport {\r\n  isUmbracoFolder,\r\n  UmbMediaTypeStructureRepository,\r\n} from \"@umbraco-cms/backoffice/media-type\";\r\nimport {\r\n  umbBindToValidation,\r\n  UmbValidationContext,\r\n} from \"@umbraco-cms/backoffice/validation\";\r\nimport {\r\n  umbConfirmModal,\r\n  UmbModalBaseElement,\r\n} from \"@umbraco-cms/backoffice/modal\";\r\nimport { UmbDocumentDetailRepository } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbMediaDetailRepository } from \"@umbraco-cms/backoffice/media\";\r\nimport type { UmbInputDocumentElement } from \"@umbraco-cms/backoffice/document\";\r\nimport type { UmbInputMediaElement } from \"@umbraco-cms/backoffice/media\";\r\nimport type {\r\n  UUIBooleanInputEvent,\r\n  UUIColorPickerChangeEvent,\r\n  UUIInputElement,\r\n  UUIInputEvent,\r\n} from \"@umbraco-cms/backoffice/external/uui\";\r\n\r\ntype UmbInputPickerEvent = CustomEvent & { target: { value?: string } };\r\n\r\n@customElement(\"button-link-picker-modal\")\r\nexport class UmbLinkPickerModalElement extends UmbModalBaseElement<\r\n  ButtonLinkPickerModalData,\r\n  ButtonLinkPickerModalValue\r\n> {\r\n  #propertyLayoutOrientation: \"horizontal\" | \"vertical\" = \"vertical\";\r\n\r\n  #validationContext = new UmbValidationContext(this);\r\n\r\n  @state()\r\n  private _allowedMediaTypeUniques?: Array<string>;\r\n\r\n  @state()\r\n  private _config: UmbLinkPickerConfig = {\r\n    hideAnchor: false,\r\n    hideTarget: false,\r\n  };\r\n\r\n  @query(\"umb-input-document\")\r\n  private _documentPickerElement?: UmbInputDocumentElement;\r\n\r\n  @query(\"umb-input-media\")\r\n  private _mediaPickerElement?: UmbInputMediaElement;\r\n\r\n  @query(\"#link-anchor\", true)\r\n  private _linkAnchorInput?: UUIInputElement;\r\n\r\n  override connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    if (this.data?.config) {\r\n      this._config = this.data.config;\r\n    }\r\n\r\n    if (this.modalContext) {\r\n      this.observe(this.modalContext.size, (size) => {\r\n        if (size === \"large\" || size === \"full\") {\r\n          this.#propertyLayoutOrientation = \"horizontal\";\r\n        }\r\n      });\r\n    }\r\n\r\n    this.#getMediaTypes();\r\n  }\r\n\r\n  protected override firstUpdated() {\r\n    this._linkAnchorInput?.addValidator(\r\n      \"valueMissing\",\r\n      () => this.localize.term(\"linkPicker_modalAnchorValidationMessage\"),\r\n      () => !this.value.link.url && !this.value.link.queryString\r\n    );\r\n  }\r\n\r\n  async #getMediaTypes() {\r\n    // Get all the media types, excluding the folders, so that files are selectable media items.\r\n    const mediaTypeStructureRepository = new UmbMediaTypeStructureRepository(\r\n      this\r\n    );\r\n    const { data: mediaTypes } =\r\n      await mediaTypeStructureRepository.requestAllowedChildrenOf(null);\r\n    this._allowedMediaTypeUniques =\r\n      (mediaTypes?.items\r\n        .map((x) => x.unique)\r\n        .filter((x) => x && !isUmbracoFolder(x)) as Array<string>) ?? [];\r\n  }\r\n\r\n  #partialUpdateLink(linkObject: Partial<ButtonLinkPickerLink>) {\r\n    this.modalContext?.updateValue({\r\n      link: { ...this.value.link, ...linkObject },\r\n    });\r\n  }\r\n\r\n  #onLinkAnchorInput(event: UUIInputEvent) {\r\n    const query = (event.target.value as string) ?? \"\";\r\n    if (query.startsWith(\"#\") || query.startsWith(\"?\")) {\r\n      this.#partialUpdateLink({ queryString: query });\r\n      return;\r\n    }\r\n\r\n    if (query.includes(\"=\")) {\r\n      this.#partialUpdateLink({ queryString: `?${query}` });\r\n    } else if (query) {\r\n      this.#partialUpdateLink({ queryString: `#${query}` });\r\n    } else {\r\n      this.#partialUpdateLink({ queryString: \"\" });\r\n    }\r\n  }\r\n\r\n  #onLinkTitleInput(event: UUIInputEvent) {\r\n    this.#partialUpdateLink({ name: event.target.value as string });\r\n  }\r\n\r\n  #onLinkTargetInput(event: UUIBooleanInputEvent) {\r\n    this.#partialUpdateLink({\r\n      target: event.target.checked ? \"_blank\" : undefined,\r\n    });\r\n  }\r\n\r\n  #onLinkUrlInput(event: UUIInputEvent) {\r\n    const url = event.target.value as string;\r\n\r\n    let name;\r\n    if (url && !this.value.link.name) {\r\n      if (URL.canParse(url)) {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        const parts = URL.parse(url);\r\n        name = parts?.hostname ?? url;\r\n      } else {\r\n        name = url;\r\n      }\r\n    }\r\n\r\n    this.#partialUpdateLink({\r\n      name: this.value.link.name || name,\r\n      type: \"external\",\r\n      url,\r\n    });\r\n  }\r\n\r\n  async #onPickerSelection(\r\n    event: UmbInputPickerEvent,\r\n    type: \"document\" | \"media\"\r\n  ) {\r\n    let icon, name, url;\r\n    const unique = event.target.value;\r\n\r\n    if (unique) {\r\n      switch (type) {\r\n        case \"document\": {\r\n          const documentRepository = new UmbDocumentDetailRepository(this);\r\n          const { data: documentData } =\r\n            await documentRepository.requestByUnique(unique);\r\n          if (documentData) {\r\n            icon = documentData.documentType.icon;\r\n            name = documentData.variants[0].name;\r\n            url = documentData.urls[0]?.url ?? \"\";\r\n          }\r\n          break;\r\n        }\r\n        case \"media\": {\r\n          const mediaRepository = new UmbMediaDetailRepository(this);\r\n          const { data: mediaData } = await mediaRepository.requestByUnique(\r\n            unique\r\n          );\r\n          if (mediaData) {\r\n            icon = mediaData.mediaType.icon;\r\n            name = mediaData.variants[0].name;\r\n            url = mediaData.urls[0].url;\r\n          }\r\n          break;\r\n        }\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    const link = {\r\n      icon,\r\n      name: this.value.link.name || name,\r\n      type: unique ? type : undefined,\r\n      unique,\r\n      url: url ?? this.value.link.url,\r\n    };\r\n\r\n    this.#partialUpdateLink(link);\r\n\r\n    await this.#validationContext.validate();\r\n  }\r\n\r\n  async #onResetUrl() {\r\n    if (this.value.link.url) {\r\n      await umbConfirmModal(this, {\r\n        color: \"danger\",\r\n        headline: this.localize.term(\"linkPicker_resetUrlHeadline\"),\r\n        content: this.localize.term(\"linkPicker_resetUrlMessage\"),\r\n        confirmLabel: this.localize.term(\"linkPicker_resetUrlLabel\"),\r\n      });\r\n    }\r\n\r\n    this.#partialUpdateLink({ type: null, url: null });\r\n  }\r\n\r\n  async #onSubmit() {\r\n    await this.#validationContext.validate();\r\n    this.modalContext?.submit();\r\n  }\r\n\r\n  #triggerDocumentPicker() {\r\n    this._documentPickerElement?.shadowRoot\r\n      ?.querySelector(\"#btn-add\")\r\n      ?.dispatchEvent(new Event(\"click\"));\r\n  }\r\n\r\n  #triggerMediaPicker() {\r\n    this._mediaPickerElement?.shadowRoot\r\n      ?.querySelector(\"#btn-add\")\r\n      ?.dispatchEvent(new Event(\"click\"));\r\n  }\r\n\r\n  #triggerExternalUrl() {\r\n    this.#partialUpdateLink({ type: \"external\" });\r\n  }\r\n\r\n  override render() {\r\n    return html`\r\n      <umb-body-layout\r\n        headline=${this.localize.term(\r\n          this.modalContext?.data.isNew\r\n            ? \"defaultdialogs_addLink\"\r\n            : \"defaultdialogs_updateLink\"\r\n        )}\r\n      >\r\n        <uui-box>\r\n          ${this.#renderLinkType()} ${this.#renderLinkAnchorInput()}\r\n          ${this.#renderLinkTitleInput()} ${this.#renderLinkTargetInput()}\r\n          ${this.#renderBackgroundColorInput()}\r\n        </uui-box>\r\n        <div slot=\"actions\">\r\n          <uui-button\r\n            label=${this.localize.term(\"general_close\")}\r\n            @click=${this._rejectModal}\r\n          ></uui-button>\r\n          <uui-button\r\n            color=\"positive\"\r\n            look=\"primary\"\r\n            label=${this.localize.term(\r\n              this.modalContext?.data.isNew ? \"general_add\" : \"general_update\"\r\n            )}\r\n            ?disabled=${!this.value.link.type}\r\n            @click=${this.#onSubmit}\r\n          ></uui-button>\r\n        </div>\r\n      </umb-body-layout>\r\n    `;\r\n  }\r\n\r\n  #onChange(e: UUIColorPickerChangeEvent) {\r\n    e.stopPropagation();\r\n    this.modalContext?.updateValue({\r\n      link: { ...this.value.link, backgroundColor: e.target.value },\r\n    });\r\n  }\r\n\r\n  #renderBackgroundColorInput() {\r\n    return html`<uui-color-picker\r\n      label=\"Eye dropper\"\r\n      .value=${this.modalContext?.value.backgroundColor}\r\n      @change=${this.#onChange}\r\n    >\r\n    </uui-color-picker>`;\r\n  }\r\n\r\n  #renderLinkType() {\r\n    return html`\r\n      <umb-property-layout\r\n        orientation=${this.#propertyLayoutOrientation}\r\n        label=${this.localize.term(\"linkPicker_modalSource\")}\r\n        mandatory\r\n      >\r\n        <div slot=\"editor\">\r\n          ${this.#renderLinkTypeSelection()} ${this.#renderDocumentPicker()}\r\n          ${this.#renderMediaPicker()} ${this.#renderLinkUrlInput()}\r\n          ${this.#renderLinkUrlInputReadOnly()}\r\n        </div>\r\n      </umb-property-layout>\r\n    `;\r\n  }\r\n\r\n  #renderLinkTypeSelection() {\r\n    if (this.value.link.type) return nothing;\r\n    return html`\r\n      <uui-button-group>\r\n        <uui-button\r\n          data-mark=\"action:document\"\r\n          look=\"placeholder\"\r\n          label=${this.localize.term(\"general_content\")}\r\n          @click=${this.#triggerDocumentPicker}\r\n        ></uui-button>\r\n        <uui-button\r\n          data-mark=\"action:media\"\r\n          look=\"placeholder\"\r\n          label=${this.localize.term(\"general_media\")}\r\n          @click=${this.#triggerMediaPicker}\r\n        ></uui-button>\r\n        <uui-button\r\n          data-mark=\"action:external\"\r\n          look=\"placeholder\"\r\n          label=${this.localize.term(\"linkPicker_modalManual\")}\r\n          @click=${this.#triggerExternalUrl}\r\n        ></uui-button>\r\n      </uui-button-group>\r\n    `;\r\n  }\r\n\r\n  #renderDocumentPicker() {\r\n    return html`\r\n      <umb-input-document\r\n        ?hidden=${!this.value.link.unique ||\r\n        this.value.link.type !== \"document\"}\r\n        .max=${1}\r\n        .showOpenButton=${true}\r\n        .value=${this.value.link.unique && this.value.link.type === \"document\"\r\n          ? this.value.link.unique\r\n          : \"\"}\r\n        @change=${(e: UmbInputPickerEvent) =>\r\n          this.#onPickerSelection(e, \"document\")}\r\n      >\r\n      </umb-input-document>\r\n    `;\r\n  }\r\n\r\n  #renderMediaPicker() {\r\n    return html`\r\n      <umb-input-media\r\n        ?hidden=${!this.value.link.unique || this.value.link.type !== \"media\"}\r\n        .allowedContentTypeIds=${this._allowedMediaTypeUniques}\r\n        .max=${1}\r\n        .value=${this.value.link.unique && this.value.link.type === \"media\"\r\n          ? this.value.link.unique\r\n          : \"\"}\r\n        @change=${(e: UmbInputPickerEvent) =>\r\n          this.#onPickerSelection(e, \"media\")}\r\n      ></umb-input-media>\r\n    `;\r\n  }\r\n\r\n  #renderLinkUrlInput() {\r\n    if (this.value.link.type !== \"external\") return nothing;\r\n    return html`\r\n      <uui-input\r\n        data-mark=\"input:url\"\r\n        label=${this.localize.term(\"placeholders_enterUrl\")}\r\n        placeholder=${this.localize.term(\"placeholders_enterUrl\")}\r\n        .value=${this.value.link.url ?? \"\"}\r\n        ?disabled=${!!this.value.link.unique}\r\n        ?required=${this._config.hideAnchor}\r\n        @change=${this.#onLinkUrlInput}\r\n        ${umbBindToValidation(this)}\r\n      >\r\n        ${when(\r\n          !this.value.link.unique,\r\n          () => html`\r\n            <div slot=\"append\">\r\n              <uui-button\r\n                slot=\"append\"\r\n                compact\r\n                label=${this.localize.term(\"general_remove\")}\r\n                @click=${this.#onResetUrl}\r\n              >\r\n                <uui-icon name=\"remove\"></uui-icon>\r\n              </uui-button>\r\n            </div>\r\n          `\r\n        )}\r\n      </uui-input>\r\n    `;\r\n  }\r\n\r\n  #renderLinkUrlInputReadOnly() {\r\n    if (!this.value.link.unique || !this.value.link.url) return nothing;\r\n    return html`<uui-input readonly value=${this.value.link.url}></uui-input>`;\r\n  }\r\n\r\n  #renderLinkAnchorInput() {\r\n    if (this._config.hideAnchor) return nothing;\r\n    return html`\r\n      <umb-property-layout\r\n        orientation=${this.#propertyLayoutOrientation}\r\n        label=${this.localize.term(\"defaultdialogs_anchorLinkPicker\")}\r\n      >\r\n        <uui-input\r\n          data-mark=\"input:anchor\"\r\n          slot=\"editor\"\r\n          id=\"link-anchor\"\r\n          label=${this.localize.term(\"placeholders_anchor\")}\r\n          placeholder=${this.localize.term(\"placeholders_anchor\")}\r\n          .value=${this.value.link.queryString ?? \"\"}\r\n          @change=${this.#onLinkAnchorInput}\r\n          ${umbBindToValidation(this)}\r\n        ></uui-input>\r\n      </umb-property-layout>\r\n    `;\r\n  }\r\n\r\n  #renderLinkTitleInput() {\r\n    return html`\r\n      <umb-property-layout\r\n        orientation=${this.#propertyLayoutOrientation}\r\n        label=${this.localize.term(\"defaultdialogs_nodeNameLinkPicker\")}\r\n      >\r\n        <uui-input\r\n          data-mark=\"input:title\"\r\n          slot=\"editor\"\r\n          label=${this.localize.term(\"defaultdialogs_nodeNameLinkPicker\")}\r\n          placeholder=${this.localize.term(\"defaultdialogs_nodeNameLinkPicker\")}\r\n          .value=${this.value.link.name ?? \"\"}\r\n          @change=${this.#onLinkTitleInput}\r\n        >\r\n        </uui-input>\r\n      </umb-property-layout>\r\n    `;\r\n  }\r\n\r\n  #renderLinkTargetInput() {\r\n    if (this._config.hideTarget) return nothing;\r\n    return html`\r\n      <umb-property-layout\r\n        orientation=${this.#propertyLayoutOrientation}\r\n        label=${this.localize.term(\"content_target\")}\r\n      >\r\n        <uui-toggle\r\n          slot=\"editor\"\r\n          label=${this.localize.term(\"defaultdialogs_openInNewWindow\")}\r\n          .checked=${this.value.link.target === \"_blank\" ? true : false}\r\n          @change=${this.#onLinkTargetInput}\r\n        >\r\n          ${this.localize.term(\"defaultdialogs_openInNewWindow\")}\r\n        </uui-toggle>\r\n      </umb-property-layout>\r\n    `;\r\n  }\r\n\r\n  static override styles = [\r\n    css`\r\n      uui-box {\r\n        --uui-box-default-padding: 0 var(--uui-size-space-5);\r\n      }\r\n\r\n      uui-button-group {\r\n        width: 100%;\r\n      }\r\n\r\n      uui-input {\r\n        width: 100%;\r\n\r\n        &[readonly] {\r\n          margin-top: var(--uui-size-space-2);\r\n        }\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\nexport default UmbLinkPickerModalElement;\r\n\r\nexport { UmbLinkPickerModalElement as element };\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"button-link-modal\": UmbLinkPickerModalElement;\r\n  }\r\n}\r\n"],"names":["_propertyLayoutOrientation","_validationContext","_UmbLinkPickerModalElement_instances","getMediaTypes_fn","partialUpdateLink_fn","onLinkAnchorInput_fn","onLinkTitleInput_fn","onLinkTargetInput_fn","onLinkUrlInput_fn","onPickerSelection_fn","onResetUrl_fn","onSubmit_fn","triggerDocumentPicker_fn","triggerMediaPicker_fn","triggerExternalUrl_fn","onChange_fn","renderBackgroundColorInput_fn","renderLinkType_fn","renderLinkTypeSelection_fn","renderDocumentPicker_fn","renderMediaPicker_fn","renderLinkUrlInput_fn","renderLinkUrlInputReadOnly_fn","renderLinkAnchorInput_fn","renderLinkTitleInput_fn","renderLinkTargetInput_fn","UmbLinkPickerModalElement","UmbModalBaseElement","__privateAdd","UmbValidationContext","_a","size","__privateSet","__privateMethod","html","_b","mediaTypeStructureRepository","UmbMediaTypeStructureRepository","mediaTypes","x","isUmbracoFolder","linkObject","event","query","url","name","parts","type","icon","unique","documentRepository","UmbDocumentDetailRepository","documentData","mediaRepository","UmbMediaDetailRepository","mediaData","link","__privateGet","umbConfirmModal","_c","nothing","umbBindToValidation","when","css","__decorateClass","state","customElement","UmbLinkPickerModalElement$1"],"mappings":"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"}